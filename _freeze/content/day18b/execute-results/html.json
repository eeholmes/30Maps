{
  "hash": "e4ac1474efe16d5cc272aeeae8deeb8c",
  "result": {
    "markdown": "---\ntitle: \"Day 18 blue (b)\"\n---\n\n\n## Code source\n\nInspired by this\n[https://twitter.com/imagineazhar/status/1593571328484790272](https://twitter.com/imagineazhar/status/1593571328484790272)\nbut then I went in a different direction.\n\n## Code to download the data\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nlibrary(marmap)\nlibrary(tidyverse)\nlibrary(sf)\nlibrary(sysfonts)\nlibrary(showtext)\nlibrary(ggtext)\n\n\n\n# ------ Typography ------ \n\nfont_add_google(\"Mukta\", \"title_font\")\nshowtext_auto()\n\ntitle_font <- \"title_font\"\n\n\n# ------ Color palette ------ \n\npalette <- colorRampPalette(c(\"#03045e\", \"#0077b6\", \"#00b4d8\",\n                              \"#90e0ef\", \"#caf0f8\", \"#caf0f8\"))\n\n# --- Coord\n\ncity_coords <- tibble(address = \"Seattle, Washington\") |> \n  tidygeocoder::geocode(address, method = 'osm', long = long, lat = lat)\n\nlong <- city_coords$long[1]\nlat <- city_coords$lat[1]\n\nbathmetry <- getNOAA.bathy(lat1 = lat, lat2 = lat+4, lon1 = long, lon2 = long-3, resolution = 1)\n\ndf <- fortify.bathy(bathmetry)|>\n  filter(z < 0)\n```\n:::\n\n\nSet the bounding box.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\ncrs2 <- 6384 # https://epsg.io/6384\n\n# 10km circle to crop in ----\ndist <-  70000\ncircle <- tibble(long=long-1, lat=lat+1) %>%\n  st_as_sf(coords = c(\"long\", \"lat\"), crs = 4326) %>%\n  st_transform(crs = crs2) %>%\n  st_buffer(dist = dist) %>%\n  st_transform(crs = 4326)\n\nbathy_crop <- df %>%\n  st_as_sf(coords = c(\"x\", \"y\"), crs = 4326) %>%\n  st_transform(crs = 4326) %>%\n  st_intersection(circle)\n```\n:::\n\n\n## Plot code\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nggplot(df) +\n  geom_tile(aes(x = x, y = y, fill = z)) +\n  coord_sf(ylim = c(lat, lat+3), xlim = c(long, long-3), expand = FALSE) +\n  geom_sf(data = circle, color = \"black\", fill =  NA) +\n  scale_fill_gradientn(colors = palette(10),\n                       labels = function(x) format(-x, big.mark = \" \", trim = TRUE)) +\n  guides(fill = guide_colorbar(label.position = \"left\", title = \"Depth (m)\")) +\n  theme_void() +\n  theme(\n    legend.position = \"right\",\n    legend.key.height = unit(2.5, \"line\"),\n    legend.key.width = unit(0.75, \"line\"),\n    plot.background = element_rect(fill = \"#FFFBF8\", color = NA),\n    plot.title = element_markdown(size=7.5)\n    ) + \n  ggtitle(\"Circle is the region of interest\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nCoordinate system already present. Adding new coordinate system, which will\nreplace the existing one.\n```\n:::\n\n::: {.cell-output-display}\n![](day18b_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nggplot() +\n  geom_sf(data = circle, color = \"black\", fill =  \"white\") +\ngeom_sf(data=bathy_crop, aes(color=z), size=1) +\n  ggtitle(\"Puget Sound Bathymetry\") +\nscale_color_gradientn(colors = palette(10),\n                       labels = function(x) format(-x, big.mark = \" \", trim = TRUE)) +\n  guides(color = guide_colorbar(label.position = \"left\", title = \"Depth (m)\"))\n```\n\n::: {.cell-output-display}\n![](day18b_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::",
    "supporting": [
      "day18b_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}